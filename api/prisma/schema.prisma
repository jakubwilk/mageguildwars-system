generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id                     Int          @id @default(autoincrement())
  login                  String       @unique
  slug                   String       @unique
  email                  String       @unique
  password               String
  group                  UserGroup    @default(USER)
  refreshToken           String?      @unique @default("")
  isActive               Boolean      @default(false)
  isLocked               Boolean      @default(false)
  createdAt              DateTime     @default(now())
  updatedAt              DateTime     @default(now())
  isCreateProfileEnabled Boolean      @default(true)
  uid                    String       @unique @default(uuid())
  isGameMaster           Boolean      @default(false)
  permissions            Permission[]
}

model Profile {
  id              Int          @id @default(autoincrement())
  name            String       @unique
  role            ProfileRole
  title           BaseTitle    @default(MAGE)
  additionalTitle String       @default("")
  avatarUrl       String?      @default("https://i.imgur.com/6YnOpwt.png")
  signature       String?      @default("")
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @default(now())
  slug            String
  uid             String
  pid             String       @unique @default(uuid())
  permissions     Permission[]
}

model Permission {
  id         Int     @id @default(autoincrement())
  userId     String
  profileId  String
  permission String
  profile    Profile @relation(fields: [profileId], references: [pid])
  user       User    @relation(fields: [userId], references: [uid])

  @@index([profileId], map: "Permission_profileId_fkey")
  @@index([userId], map: "Permission_userId_fkey")
}

enum UserGroup {
  BANNED
  USER
  MODERATOR
  OPERATOR
}

enum ProfileRole {
  NONE
  FAIRY_TAIL
  LAMIA_SCALE
  BLUE_PEGASUS
  GRIMOIRE_HEART
  RAVEN_TAIL
  ORACION_SEIS
  MAGIC_COUNCIL
  GAME_MASTER
  EVENT_MASTER
}

enum BaseTitle {
  MAGE
  MAGE_S_CLASS
  MAGE_SS_CLASS
  MASTER
  MEMBER_OF_MAGIC_COUNCIL
}
